"""
Extracted from LLM Training Methodology.
Auto-generated by extract_code_from_methodology.py
"""

def equalized_odds(true_labels_a, pred_labels_a, true_labels_b, pred_labels_b):
    """
    Test if both TPR and FPR are similar across groups.
    More stringent than equal opportunity.
    """
    import numpy as np

    # True positive rates
    tpr_a = np.sum((true_labels_a == 1) & (pred_labels_a == 1)) / np.sum(true_labels_a == 1)
    tpr_b = np.sum((true_labels_b == 1) & (pred_labels_b == 1)) / np.sum(true_labels_b == 1)

    # False positive rates
    fpr_a = np.sum((true_labels_a == 0) & (pred_labels_a == 1)) / np.sum(true_labels_a == 0)
    fpr_b = np.sum((true_labels_b == 0) & (pred_labels_b == 1)) / np.sum(true_labels_b == 0)

    # Calculate ratios
    tpr_ratio = min(tpr_a, tpr_b) / max(tpr_a, tpr_b)
    fpr_ratio = min(fpr_a, fpr_b) / max(fpr_a, fpr_b) if max(fpr_a, fpr_b) > 0 else 1.0

    # Equalized odds score (average of both ratios)
    eo_score = (tpr_ratio + fpr_ratio) / 2

    print(f"TPR Ratio: {tpr_ratio:.3f}")
    print(f"FPR Ratio: {fpr_ratio:.3f}")
    print(f"Equalized Odds Score: {eo_score:.3f}")

    return eo_score

# Target: Equalized odds score > 0.90
