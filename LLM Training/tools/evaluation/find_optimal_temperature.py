"""
Extracted from LLM Training Methodology.
Auto-generated by extract_code_from_methodology.py
"""

# Temperature scaling (simple, effective)
from sklearn.linear_model import LogisticRegression

# Find optimal temperature on validation set
def find_optimal_temperature(logits, labels):
    """Find temperature that minimizes ECE."""
    temperatures = np.linspace(0.5, 3.0, 50)
    best_ece = float('inf')
    best_temp = 1.0

    for temp in temperatures:
        calibrated_probs = softmax(logits / temp)
        ece, _ = expected_calibration_error(
            calibrated_probs.argmax(1),
            labels,
            calibrated_probs.max(1)
        )
        if ece < best_ece:
            best_ece = ece
            best_temp = temp

    return best_temp

# Apply temperature scaling
optimal_temp = find_optimal_temperature(val_logits, val_labels)
calibrated_confidences = softmax(test_logits / optimal_temp)
